@model IEnumerable<HealthApp.MVC.Models.Entities.Doctor>
@{
    ViewData["Title"] = "Rechercher un Médecin";
}

<div class="container mt-5 text-center">
    <h2 class="mb-4">@ViewData["Title"]</h2>

    <div class="card shadow-sm mx-auto mb-4" style="max-width: 800px;">
        <div class="card-body">
            <!-- Barre de recherche et boutons radio -->
            <div class="row justify-content-center">
                <div class="col-md-8">
                    <input type="text" id="queryInput" class="form-control" placeholder="Saisissez votre recherche..." />
                </div>
                <div class="col-md-4 text-left text-md-center mt-3 mt-md-0">
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="searchMode" id="searchByName" value="Name" checked />
                        <label class="form-check-label" for="searchByName">Nom / Prénom</label>
                    </div>
                    <div class="form-check form-check-inline">
                        <input class="form-check-input" type="radio" name="searchMode" id="searchBySpec" value="Specialization" />
                        <label class="form-check-label" for="searchBySpec">Spécialité</label>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Conteneur qui sera mis à jour dynamiquement -->
    <div id="doctorListContainer" class="mx-auto" style="max-width: 800px;">
        @await Html.PartialAsync("_DoctorList", Model)
    </div>
</div>

@section Scripts {
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script>
        $(document).ready(function () {
            $("#queryInput, input[name='searchMode']").on("keyup change", function () {
                var query = $("#queryInput").val();
                var searchMode = $("input[name='searchMode']:checked").val();
                $.ajax({
                    url: '@Url.Action("Book", "Appointment", new { area = "Patients" })',
                    data: { query: query, searchMode: searchMode },
                    success: function (data) {
                        $("#doctorListContainer").html(data);
                    },
                    error: function () {
                        $("#doctorListContainer").html("<div class='alert alert-danger'>Erreur lors de la recherche.</div>");
                    }
                });
            });
        });
    </script>
}
